<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task Manager - Zyro</title>
    <style>
        :root { --bg: #1a1b1e; --panel: #202124; --text: #e8eaed; --accent: #8ab4f8; --danger: #e06c75; }
        body.theme-light { --bg: #f1f3f4; --panel: #ffffff; --text: #202124; --accent: #1a73e8; }
        
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 40px; max-width: 1000px; margin: 0 auto; }
        h1 { margin-bottom: 20px; font-weight: 300; border-bottom: 1px solid #444; padding-bottom: 10px; }
        
        .stats-bar { display: flex; gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--panel); padding: 15px 25px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.2); flex: 1; }
        .stat-card h3 { margin: 0 0 5px 0; font-size: 14px; opacity: 0.7; }
        .stat-card div { font-size: 24px; font-weight: bold; color: var(--accent); }

        table { width: 100%; border-collapse: collapse; background: var(--panel); border-radius: 8px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        th { text-align: left; padding: 15px; background: rgba(0,0,0,0.2); font-weight: 600; font-size: 14px; color: var(--accent); }
        td { padding: 12px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 14px; }
        tr:last-child td { border-bottom: none; }
        tr:hover { background: rgba(255,255,255,0.03); }

        .col-id { width: 60px; font-family: monospace; opacity: 0.6; }
        .col-mem { width: 100px; font-weight: bold; }
        .col-action { width: 100px; text-align: right; }

        button.kill-btn {
            background: transparent; border: 1px solid var(--danger); color: var(--danger);
            padding: 6px 12px; border-radius: 4px; cursor: pointer; transition: all 0.2s;
        }
        button.kill-btn:hover { background: var(--danger); color: white; }

        .url-sub { display: block; font-size: 12px; opacity: 0.5; margin-top: 2px; }
    </style>
</head>
<body class="theme-dark">
    <h1>Task Manager</h1>

    <div class="stats-bar">
        <div class="stat-card"><h3>Total Tabs</h3><div id="total-tabs">0</div></div>
        <div class="stat-card"><h3>Zyro Memory</h3><div id="total-mem">Calculating...</div></div>
    </div>

    <table>
        <thead>
            <tr>
                <th>PID</th>
                <th>Tab Name / URL</th>
                <th>Memory</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="task-list">
            </tbody>
    </table>

 <script>
        function setTheme(t) { document.body.className = 'theme-' + t; }
        
        // CHANGED: Added totalMem argument
        function renderTasks(tasks, totalMem) {
            const tbody = document.getElementById('task-list');
            tbody.innerHTML = '';
            
            document.getElementById('total-tabs').innerText = tasks.length;
            
            // DIRECTLY USE THE VALUE FROM C++
            document.getElementById('total-mem').innerText = totalMem || "Calculating...";

            tasks.forEach(t => {
                const tr = document.createElement('tr');
                
                // UX Improvement: Show "Shared" instead of 0/-
                let memDisplay = t.mem;
                if (memDisplay === "-" || memDisplay === "0" || memDisplay === "N/A") {
                    memDisplay = '<span style="opacity:0.5; font-size:12px">Shared / Core</span>';
                }

                let pidDisplay = t.pid > 0 ? t.pid : '<span style="opacity:0.5">-</span>';

                tr.innerHTML = `
                    <td class="col-id">${pidDisplay}</td>
                    <td>
                        <div>${t.title}</div>
                        <span class="url-sub">${t.url}</span>
                    </td>
                    <td class="col-mem">${memDisplay}</td>
                    <td class="col-action">
                        <button class="kill-btn" onclick="killTab(${t.id})">End Task</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function killTab(index) {
            window.webkit.messageHandlers.zyro.postMessage(JSON.stringify({ 
                type: 'close_task_tab', 
                index: index 
            }));
        }

        function refreshTasks() {
            window.webkit.messageHandlers.zyro.postMessage(JSON.stringify({ type: 'get_tasks' }));
        }

        setInterval(refreshTasks, 2000);

        window.onload = () => {
            window.webkit.messageHandlers.zyro.postMessage(JSON.stringify({ type: 'get_theme' }));
            refreshTasks();
        }
    </script>
</body>
</html>